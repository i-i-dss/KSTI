<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>KSTI 테스트</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
  
  <script src="questions.js"></script>
  <script src="philosophers.js"></script>

  <script>
    // Store answers globally
    const answers = {};
  </script>

  <script>
    function calculateResult() {
      const scores = { R: 0, E: 0, I: 0, A: 0, O: 0, U: 0, S: 0, P: 0 };
      for (let i = 0; i < questions.length; i++) {
        const value = answers[i];
        if (value === undefined) {
          alert(`${i + 1}번 질문에 응답해주세요.`);
          document.querySelector(`input[name='q${i}']`)?.scrollIntoView({ behavior: "smooth", block: "center" });
          return;
        }
        const axis = questions[i].axis;
        const oppositeAxis = { R: "E", E: "R", I: "A", A: "I", O: "U", U: "O", S: "P", P: "S" };
        const scoreTarget = parseInt(value) >= 2 ? axis : oppositeAxis[axis];
        scores[scoreTarget]++;
      }

      const resultCode = [
        scores.R >= scores.E ? "R" : "E",
        scores.I >= scores.A ? "I" : "A",
        scores.O >= scores.U ? "O" : "U",
        scores.S >= scores.P ? "S" : "P"
      ].join("");

      // Redirect to result page with query parameter and scores
      const scoreParam = encodeURIComponent(JSON.stringify(scores));
      window.location.href = `result.html?type=${resultCode}&scores=${scoreParam}`;
    }

    let currentPage = 0;
    const questionsPerPage = 10;

    function renderQuestions() {
      const container = document.getElementById("question-container");
      container.innerHTML = "";

      const start = currentPage * questionsPerPage;
      const end = Math.min(start + questionsPerPage, questions.length);

      for (let i = start; i < end; i++) {
        const q = questions[i];
        const el = document.createElement("div");
        el.className = "mb-4 p-4 bg-white rounded shadow";
        el.innerHTML = `
          <p class="font-semibold mb-2">${i + 1}. ${q.text}</p>
          <label class="block"><input type="radio" name="q${i}" value="3" ${answers[i] === "3" ? "checked" : ""} onchange="answers[${i}] = '3'" class="mr-2"> 매우 그렇다</label>
          <label class="block"><input type="radio" name="q${i}" value="2" ${answers[i] === "2" ? "checked" : ""} onchange="answers[${i}] = '2'" class="mr-2"> 다소 그렇다</label>
          <label class="block"><input type="radio" name="q${i}" value="1" ${answers[i] === "1" ? "checked" : ""} onchange="answers[${i}] = '1'" class="mr-2"> 다소 아니다</label>
          <label class="block"><input type="radio" name="q${i}" value="0" ${answers[i] === "0" ? "checked" : ""} onchange="answers[${i}] = '0'" class="mr-2"> 매우 아니다</label>
        `;
        container.appendChild(el);
      }

      const buttonContainer = document.createElement("div");
      buttonContainer.className = "mt-6";

      if (end >= questions.length) {
        const resultButton = document.createElement("button");
        resultButton.textContent = "결과 보기";
        resultButton.onclick = calculateResult;
        resultButton.className = "bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded";
        buttonContainer.appendChild(resultButton);
      } else {
        const nextButton = document.createElement("button");
        nextButton.textContent = "다음 →";
        nextButton.onclick = () => {
          const start = currentPage * questionsPerPage;
          const end = Math.min(start + questionsPerPage, questions.length);

          for (let i = start; i < end; i++) {
            if (answers[i] === undefined) {
              alert(`${i + 1}번 질문에 응답해주세요.`);
              document.querySelector(`input[name='q${i}']`)?.scrollIntoView({ behavior: "smooth", block: "center" });
              return;
            }
          }

          currentPage++;
          renderQuestions();
        };
        nextButton.className = "bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded";
        buttonContainer.appendChild(nextButton);
      }

      container.appendChild(buttonContainer);
    }
  </script>
</head>
<body class="bg-gray-100 text-gray-800">
  <div class="max-w-2xl mx-auto p-6">
    <h1 class="text-3xl font-bold mb-4">철학 MBTI 테스트</h1>
    <p class="mb-6 text-gray-700">아래 문장을 읽고 자신에게 가장 가까운 답을 선택해주세요.</p>
    <div id="question-container"></div>
    <div id="result" class="mt-8"></div>
  </div>
  <script>renderQuestions();</script>
</body>
</html>
